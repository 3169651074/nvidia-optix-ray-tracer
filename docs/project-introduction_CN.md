# 项目介绍

## 概述

RendererOptiX 是一个基于 NVIDIA OptiX 9.0 实现的高性能实时渲染器，专门用于渲染 VTK（Visualization Toolkit）特定格式的粒子数据。该项目结合了现代光线追踪技术和多种图形 API，提供了一个灵活且高效的渲染解决方案。

## 项目目标

- **高性能渲染**：利用 GPU 光线追踪技术实现实时渲染
- **易用性**：通过 JSON 配置文件统一渲染参数设置
- **跨平台支持**：支持 Windows 和 Linux 平台
- **多 API 兼容**：支持使用 OpenGL、Vulkan、Direct3D11、Direct3D12 显示渲染画面
- **可扩展性**：模块化设计，便于扩展新功能

## 核心特性

### 1. OptiX 光线追踪

项目使用 NVIDIA OptiX 9.0 作为核心渲染引擎，实现了：

- 实时光线追踪
- 多种几何体支持（球体、三角形、VTK 粒子）
- 材质系统（粗糙材质和金属材质）
- 降噪处理，集成了OptiX AI Denoiser

### 2. VTK 数据支持

- 支持读取 VTK 序列文件（`.vtk.series`）
- 自动解析粒子几何数据
- 支持粒子缓存以加速加载
- 使用多线程读写缓存文件

### 3. 图形 API

项目实现了现代图形 API 和CUDA的互操作，支持：

- **OpenGL**：跨平台标准图形 API
- **Vulkan**：现代低级别图形 API
- **Direct3D11**：Windows 平台（仅 Windows）
- **Direct3D12**：Windows 平台现代 API（仅 Windows）

### 4. 交互式控制

- 鼠标控制相机旋转
- 键盘控制相机移动（WASD移动 + Space/Left Shift上升下降）
- 滚轮调节移动速度（向上滚动加速移动）
- 单击鼠标左键释放鼠标自由移动，再次单击可回到窗口中
- 可配置的相机参数

## 架构设计

### 整体架构

```text
┌─────────────────────────────────────────┐
         应用程序入口 (Main.cu)
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
  渲染器接口层 (RendererTime/RendererMesh)
  - 数据提交和初始化
  - 渲染循环控制
  - 资源管理
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
     渲染器实现层 (RendererImpl.cuh)
  - OptiX 上下文管理
  - 加速结构构建 (GAS/IAS)
  - 着色器绑定表 (SBT)
  - 降噪器管理
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
     图形 API 层 (SDL_GraphicsWindow)
  - 窗口管理
  - 图形资源管理
  - CUDA-SDL-图形 API 互操作
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
     工具层 (Util)
  - VTK 文件读取
  - JSON 配置解析
  - 颜色映射和粒子材质生成
└─────────────────────────────────────────┘
```

### 核心模块

#### 1. 渲染器核心 (Renderer)

`Renderer` 类提供了渲染器的主要接口：

- `commitRendererData()`：提交几何体和材质数据，初始化渲染器
- `startRender()`：启动渲染循环
- `freeRendererData()`：释放渲染资源

#### 2. OptiX 实现 (RendererImpl)

实现了 OptiX 相关的底层操作：

- **上下文管理**：创建和销毁 OptiX 设备上下文
- **加速结构**：构建几何加速结构（GAS）和实例加速结构（IAS）
- **着色器模块**：加载和编译 PTX 着色器
- **程序组**：创建光线生成、未命中、最近命中程序组
- **降噪器**：初始化和管理 OptiX 降噪器

#### 3. 图形 API 封装

`SDL_GraphicsWindow` 提供了统一的图形 API 接口：

- 窗口创建和管理
- 图形资源（纹理、缓冲区）管理
- CUDA 与图形 API 的互操作
- 输入事件处理

#### 4. VTK 读取器 (VTKReader)

负责读取和处理 VTK 数据：

- 解析 VTK 序列文件
- 读取粒子几何数据
- 缓存管理（读写缓存文件）
- 多线程数据加载

## 数据流

### 渲染流程

1. **初始化阶段**
   - 解析 JSON 配置文件
   - 读取 VTK 数据或加载缓存
   - 构建几何体和材质数据
   - 初始化 OptiX 上下文和管线

2. **每帧渲染**
   - 更新相机参数
   - 更新实例变换矩阵
   - 执行 OptiX 光线追踪
   - 应用降噪处理
   - 将结果复制到图形 API 资源
   - 呈现到屏幕

3. **清理阶段**
   - 释放设备内存
   - 销毁加速结构
   - 关闭 OptiX 上下文
   - 销毁图形 API 资源

### 内存管理

- **主机内存**：存储配置数据和元数据
- **设备内存**：存储几何数据、材质数据、加速结构
- **页面锁定内存**：用于实例数组，加速 CPU-GPU 传输
- **CUDA 数组**：用于与图形 API 共享渲染结果

## 技术栈

- **CUDA**：GPU 计算和内存管理
- **OptiX 9.0**：光线追踪引擎
- **VTK 9.5**：VTK 文件读取
- **SDL2**：窗口和输入管理
- **Vulkan/DirectX/OpenGL**：图形渲染后端
- **nlohmann/json**：JSON 配置解析
- **CMake**：构建系统

## 应用场景

- **科学可视化**：渲染大规模粒子数据
- **数据探索**：交互式查看 VTK 数据集
- **渲染研究**：光线追踪技术学习和实验
- **性能测试**：GPU 光线追踪性能评估

## 未来规划

- 支持更多几何体类型
- 实现更复杂的材质模型
- 添加体积渲染支持
- 优化大规模场景渲染性能
- 支持多 GPU 渲染
- 添加后处理效果
